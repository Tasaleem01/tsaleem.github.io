<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฅูุดุงุก ุญุณุงุจ ูููุฏุณ | ููุตุฉ ุงูุชุณููู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        body { font-family: 'Cairo', sans-serif; background-color: #f1f5f9; }
        .input-field {
            width: 100%; padding: 0.85rem; border: 2px solid #f1f5f9; border-radius: 1.25rem;
            outline: none; transition: all 0.3s; background: #f8fafc;
        }
        .input-field:focus { border-color: #3b82f6; background: #fff; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="bg-white p-8 md:p-10 rounded-[2.5rem] shadow-2xl w-full max-w-lg border border-slate-100">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-slate-800">ุญุณุงุจ ูููุฏุณ ุฌุฏูุฏ โก</h2>
            <p class="text-slate-500 mt-2 text-sm">ูุฑุฌู ุฅุฏุฎุงู ุจูุงูุงุชู ุจุฏูุฉ ูุชุชููู ูู ุฑูุน ุงูุชููููุงุช</p>
        </div>
        
        <form id="regForm" class="space-y-4">
            <div>
                <label class="block text-xs font-bold text-slate-500 mb-1 mr-2">ุงูุงุณู ุงูุซูุงุซู (ุนูู ุงูุฃูู)</label>
                <input type="text" id="regName" placeholder="ูุซุงู: ูุญูุฏ ุฃุญูุฏ ุนูู" class="input-field" required>
            </div>

            <div>
                <label class="block text-xs font-bold text-slate-500 mb-1 mr-2">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (Gmail)</label>
                <input type="email" id="regEmail" placeholder="example@gmail.com" class="input-field" required>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1 mr-2">ุงูุฑูู ุงูุฌุงูุนู / Index</label>
                    <input type="text" id="regIndex" placeholder="ูุซุงู: ps_22_011" class="input-field">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1 mr-2">ุงูุฌุงูุนุฉ ูุงูุชุฎุตุต</label>
                    <select id="regCollege" class="input-field cursor-pointer">
                        <option value="ุงูุณูุฏุงู ุงูุนุงูููุฉ_ููุฑุจุงุก">ุงูุณูุฏุงู ุงูุนุงูููุฉ - ููุฑุจุงุก</option>
                        <option value="ุงูุณูุฏุงู ุงูุนุงูููุฉ_ุงููุชุฑูููุงุช">ุงูุณูุฏุงู ุงูุนุงูููุฉ - ุงููุชุฑูููุงุช</option>
                        <option value="ุงูุณูุฏุงู ุงูุนุงูููุฉ_ุทุจูุฉ">ุงูุณูุฏุงู ุงูุนุงูููุฉ - ููุฏุณุฉ ุทุจูุฉ</option>
                        <option value="ุงูุณูุฏุงู ุงูุนุงูููุฉ_ุงุชุตุงูุงุช">ุงูุณูุฏุงู ุงูุนุงูููุฉ - ุงุชุตุงูุงุช</option>
                        <option value="ุงูุญูุงุฉ_ุทุจูุฉ">ุงูุญูุงุฉ - ููุฏุณุฉ ุทุจูุฉ</option>
                        <option value="ุงูุญูุงุฉ_ููุฑุจุงุก">ุงูุญูุงุฉ - ููุฏุณุฉ ููุฑุจุงุก</option>
                        <option value="ุงูุญูุงุฉ_ุงุชุตุงูุงุช">ุงูุญูุงุฉ - ุงุชุตุงูุงุช</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="password" id="regPass" placeholder="ูููุฉ ุงููุฑูุฑ" class="input-field" required>
                <input type="password" id="regConfirm" placeholder="ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ" class="input-field" required>
            </div>

            <button type="submit" class="w-full bg-slate-800 text-white py-4 rounded-2xl font-bold text-lg hover:bg-slate-900 transition-all shadow-lg active:scale-[0.98]">
                ุฅูุดุงุก ุงูุญุณุงุจ ูุชูุซููู ๐ง
            </button>

            <div id="regMessage" class="hidden text-center font-bold p-4 rounded-2xl text-sm animate-pulse"></div>

            <p class="text-center text-slate-400 text-xs mt-4">
                ูุฏูู ุญุณุงุจ ุจุงููุนูุ <a href="index.html" class="text-blue-600 font-bold underline">ุณุฌู ุฏุฎููู ููุง</a>
            </p>
        </form>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // ุถุน ุจูุงูุงุชู ููุง
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        const regForm = document.getElementById('regForm');

        regForm.onsubmit = async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('regName').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const index = document.getElementById('regIndex').value.trim() || "indexnumber";
            const college = document.getElementById('regCollege').value;
            const pass = document.getElementById('regPass').value;
            const confirm = document.getElementById('regConfirm').value;

            // 1. ุงูุชุญูู ูู ุงูุงุณู ุงูุซูุงุซู (ุงูุฏุงูุฉ ุงููุทููุจุฉ)
            const nameParts = name.split(/\s+/).filter(p => p.length > 0);
            if (nameParts.length < 3) {
                return showMessage("ูุฑุฌู ุฅุฏุฎุงู ุงุณูู ุงูุฑุจุงุนู ุฃู ุงูุซูุงุซู ูุงููุงู!", "red");
            }

            // 2. ุงูุชุญูู ูู ุชุทุงุจู ูููุฉ ุงููุฑูุฑ
            if (pass !== confirm) {
                return showMessage("ูููุงุช ุงููุฑูุฑ ุบูุฑ ูุชุทุงุจูุฉ!", "red");
            }
            if (pass.length < 6) {
                return showMessage("ูููุฉ ุงููุฑูุฑ ูุฌุจ ุฃู ุชููู 6 ุฃุญุฑู ุนูู ุงูุฃูู", "red");
            }

            showMessage("ุฌุงุฑู ุฅูุดุงุก ุงูุญุณุงุจ... ูุฑุฌู ุงูุงูุชุธุงุฑ โณ", "blue");

            try {
                // 3. ุฅูุดุงุก ุงูุญุณุงุจ ูู Firebase
                const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
                const user = userCredential.user;

                // 4. ุฅุฑุณุงู ุจุฑูุฏ ุงูุชูุซูู
                await sendEmailVerification(user);

                // 5. ุญูุธ ุงูุจูุงูุงุช ูู Realtime Database
                await set(ref(db, 'users/' + user.uid), {
                    fullName: name,
                    academicIndex: index,
                    college: college,
                    email: email,
                    role: "student"
                });

                showMessage("โ ุชู ุฅูุดุงุก ุงูุญุณุงุจ ุจูุฌุงุญ! ุชููุฏ ุจุฑูุฏู ุงูุฅููุชุฑููู ุงูุขู ูุชูุนูู ุงูุญุณุงุจ ูุจู ุงูุฏุฎูู.", "green");
                regForm.reset();

            } catch (error) {
                let msg = "ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุณุฌูู";
                if (error.code === "auth/email-already-in-use") msg = "ูุฐุง ุงูุจุฑูุฏ ูุณุฌู ุจุงููุนู!";
                showMessage(msg + ": " + error.message, "red");
            }
        };

        function showMessage(text, color) {
            const msgDiv = document.getElementById('regMessage');
            msgDiv.innerText = text;
            msgDiv.className = `block text-center font-bold p-4 rounded-2xl text-sm bg-${color}-50 text-${color}-700 border border-${color}-100 mt-4`;
        }
    </script>
</body>
</html>